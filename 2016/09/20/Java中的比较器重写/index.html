<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Java中的比较器重写 | 邢鹏飞的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Java中的比较器重写</h1><a id="logo" href="/.">邢鹏飞的博客</a><p class="description">Make a difference</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 主页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Java中的比较器重写</h1><div class="post-meta">Sep 20, 2016</div><div class="post-content"><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>Java中经常会遇到重写比较器的情况，比如给某个自定义类根据一个属性的值进行排序，今天看到一个非常经典的数据结构设计的问题，不仅问题设计很好，中间居然还会重写两种比较器（因为之前接触的都是单独出现的），不禁拍案叫绝！</p>
<p>问题是要求设计一个简化版Twitter的数据结构，能够支持post, follow, unfollow几种操作，具体要求如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. postTweet(userId, tweetId): Compose a new tweet.</span><br><span class="line">2. getNewsFeed(userId): Retrieve the 10 most recent tweet ids in the user&apos;s news feed. Each item in the news feed must be posted by users who the user followed or by the user herself. Tweets must be ordered from most recent to least recent.</span><br><span class="line">3. follow(followerId, followeeId): Follower follows a followee.</span><br><span class="line">4. unfollow(followerId, followeeId): Follower unfollows a followee.</span><br></pre></td></tr></table></figure>
<h3 id="分析思路"><a href="#分析思路" class="headerlink" title="分析思路"></a>分析思路</h3><p>首先，需要为该系统引入两个HashMap。第一个Map是<code>&lt;User, List&lt;User&gt;&gt;</code>，主要用来记录某个用户关注的用户列表；第二个Map是<code>&lt;User, List&lt;Twitter&gt;&gt;</code>，主要用来记录某个用户发送的所有微博。</p>
<p>功能1只需要修改第二个Map，比较easy;<br>功能3，4只需要修改第一个Map；<br>功能三需要通过建立小顶堆来实现，较前几个功能稍显复杂。</p>
<p>正如开头所说，代码中比较有意思的是两种比较器的重写。第一种是给自定义类写比较器，比如在后续代码中需要用到该类的比较、排序等等。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">A</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> val;</span><br><span class="line">	&lt;!--<span class="keyword">do</span> something here--&gt;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(A other)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.val - other.val; &lt;!--Increasing Order--&gt;</span><br><span class="line">		<span class="keyword">return</span> other.val - <span class="keyword">this</span>.val; &lt;!--Decreasing Order--&gt;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二种是在容器的sort方法中重写。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A[] arr = <span class="keyword">new</span> A[<span class="number">10</span>];</span><br><span class="line">Collections.sort(A, <span class="keyword">new</span> Comparator&lt;A&gt;()&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(A a, A b)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a.val - b.val; &lt;!--Increasing Order--&gt;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Twitter</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TContent</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">TContent</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id;</span><br><span class="line">        <span class="keyword">int</span> tweetId;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TContent</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> tweetId)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.id = id;</span><br><span class="line">            <span class="keyword">this</span>.tweetId = tweetId;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(TContent other)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.id - other.id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    Map&lt;Integer, Set&lt;Integer&gt;&gt; follow;</span><br><span class="line">    Map&lt;Integer, List&lt;TContent&gt;&gt; tweet;</span><br><span class="line">    <span class="comment">/** Initialize your data structure here. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Twitter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        follow = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        tweet = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        id = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** Compose a new tweet. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postTweet</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> tweetId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (! tweet.containsKey(userId)) tweet.put(userId, <span class="keyword">new</span> ArrayList&lt;TContent&gt;());</span><br><span class="line">        List&lt;TContent&gt; tweets = tweet.get(userId);</span><br><span class="line">        tweets.add(<span class="keyword">new</span> TContent(id ++, tweetId));</span><br><span class="line">        tweet.put(userId, tweets);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** Retrieve the 10 most recent tweet ids in the user's news feed. Each item in the news feed must be posted by users who the user followed or by the user herself. Tweets must be ordered from most recent to least recent. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">getNewsFeed</span><span class="params">(<span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">        Set&lt;Integer&gt; users = follow.containsKey(userId) ? follow.get(userId) : <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">        users.add(userId);</span><br><span class="line">        PriorityQueue&lt;TContent&gt; queue = <span class="keyword">new</span> PriorityQueue&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Integer, List&lt;TContent&gt;&gt; e : tweet.entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (users.contains(e.getKey())) &#123;</span><br><span class="line">                List&lt;TContent&gt; ts = e.getValue();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ts.size(); i ++) &#123;</span><br><span class="line">                    queue.add(ts.get(i));</span><br><span class="line">                    <span class="keyword">if</span> (queue.size() &gt; <span class="number">10</span>) queue.poll();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;TContent&gt; tmp = <span class="keyword">new</span> ArrayList&lt;TContent&gt;();</span><br><span class="line">        <span class="keyword">while</span> (! queue.isEmpty()) &#123;</span><br><span class="line">            tmp.add(queue.poll());</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.sort(tmp, <span class="keyword">new</span> Comparator&lt;TContent&gt;() &#123;</span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(TContent a, TContent b)</span> </span>&#123;</span><br><span class="line">               <span class="keyword">return</span> b.id - a.id;</span><br><span class="line">           &#125; </span><br><span class="line">        &#125;);</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tmp.size(); i ++) &#123;</span><br><span class="line">            result.add(tmp.get(i).tweetId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** Follower follows a followee. If the operation is invalid, it should be a no-op. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">follow</span><span class="params">(<span class="keyword">int</span> followerId, <span class="keyword">int</span> followeeId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (! follow.containsKey(followerId)) follow.put(followerId, <span class="keyword">new</span> HashSet&lt;Integer&gt;());</span><br><span class="line">        Set&lt;Integer&gt; followees = follow.get(followerId);</span><br><span class="line">        followees.add(followeeId);</span><br><span class="line">        follow.put(followerId, followees);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** Follower unfollows a followee. If the operation is invalid, it should be a no-op. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unfollow</span><span class="params">(<span class="keyword">int</span> followerId, <span class="keyword">int</span> followeeId)</span> </span>&#123;</span><br><span class="line">        Set&lt;Integer&gt; followees = follow.get(followerId);</span><br><span class="line">        <span class="keyword">if</span> (followees == <span class="keyword">null</span> || !followees.contains(followeeId)) <span class="keyword">return</span>;</span><br><span class="line">        followees.remove(followeeId);</span><br><span class="line">        follow.put(followerId, followees);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/Algorithm/">Algorithm</a></div><div class="post-nav"><a class="pre" href="/2016/09/22/类Sweep-Line问题分析/">类Sweep Line问题分析</a><a class="next" href="/2016/07/31/英语俚语/">英语俚语</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/SpriteKit/" style="font-size: 15px;">SpriteKit</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/FullStack/" style="font-size: 15px;">FullStack</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/IOS/" style="font-size: 15px;">IOS</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Scrappy/" style="font-size: 15px;">Scrappy</a> <a href="/tags/Backend/" style="font-size: 15px;">Backend</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/Mobile/" style="font-size: 15px;">Mobile</a> <a href="/tags/Cheet-Sheet/" style="font-size: 15px;">Cheet Sheet</a> <a href="/tags/WatchOS/" style="font-size: 15px;">WatchOS</a> <a href="/tags/Unity/" style="font-size: 15px;">Unity</a> <a href="/tags/Game/" style="font-size: 15px;">Game</a> <a href="/tags/Diary/" style="font-size: 15px;">Diary</a> <a href="/tags/系统/" style="font-size: 15px;">系统</a> <a href="/tags/System/" style="font-size: 15px;">System</a> <a href="/tags/OOD/" style="font-size: 15px;">OOD</a> <a href="/tags/RESTful/" style="font-size: 15px;">RESTful</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/01/01/写在岁末年初（2016）/">写在岁末年初（2016）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/18/Algorithm-Exercise-7/">Algorithm Exercise 7(Lyft)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/15/hash相关/">hash相关</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/14/Java死锁例子/">Java死锁例子</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/14/Java中abstract和interface区别/">Java中abstract和interface区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/11/Algorithm-Exercise-6/">Algorithm Exercise 6</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/01/Algorithm-Exercise-5/">Algorithm Exercise 5</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/30/Algorithm-Exercise-4/">Algorithm Exercise 4</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/29/Algorithm-Exercise-3/">Algorithm Exercise 3</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/28/Algorithm-Exercise-2/">Algorithm Exercise 2</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">邢鹏飞的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>